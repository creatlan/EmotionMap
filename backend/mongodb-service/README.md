# MongoDB Service - EmotionMap

This service acts as a wrapper around MongoDB, providing a RESTful API to manage data for emotion points, users, and emotion definitions (types and colors).

## Endpoints

### Points Management

#### `GET /points`
- **Description**: Retrieve all emotion points stored in the database.
- **Response**: Array of point objects.
  ```json
  [
    {
      "_id": "string (ObjectID)",
      "username": "string",
      "text": "string",
      "coords": { "lat": "float", "lng": "float" },
      "label": "string", // Emotion label (e.g., "joy")
      "score": "float",  // Confidence score from ML analysis or 1.0 for manual
      "timestamp": "string (ISO Date)"
    }
  ]
  ```

#### `GET /points/{username}`
- **Description**: Retrieve all emotion points for a specific user.
- **Path Parameters**:
  - `username` (string): The username whose points are to be retrieved.
- **Response**: Array of point objects, same structure as `GET /points`.

#### `POST /points`
- **Description**: Add a new emotion point to the database.
- **Request Body**:
  ```json
  {
    "username": "string",
    "text": "string",
    "coords": { "lat": "float", "lng": "float" },
    "label": "string",
    "score": "float",
    "timestamp": "string (ISO Date)" // Typically generated by the client or service
  }
  ```
- **Response**: The created point object with its `_id`.

#### `PUT /points/`
- **Description**: Update an existing emotion point. The point ID is expected in the request body.
- **Request Body**:
  ```json
  {
    "id": "string (ObjectID)", // ID of the point to update
    "text": "string",          // New text
    "coords": { "lat": "float", "lng": "float" }, // New coordinates
    "label": "string",         // New label
    "score": "float",          // New score
    "timestamp": "string (ISO Date)" // New timestamp
  }
  ```
- **Response**: The updated point object.

#### `DELETE /points/{_id}`
- **Description**: Delete a specific point by its ID.
- **Path Parameters**:
  - `_id` (string): The ObjectID of the point to delete.
- **Response**:
  ```json
  {
    "status": "ok",
    "message": "Point deleted successfully"
  }
  ```

### User Management

#### `POST /users/register`
- **Description**: Create a new user account.
- **Request Body**:
  ```json
  {
    "username": "string",
    "password": "string"
  }
  ```
- **Response**: Success message or error if username exists.
  ```json
  { "message": "User registered successfully" }
  ```

#### `POST /users/login`
- **Description**: Authenticate a user and return a token (if using token-based auth).
- **Request Body**:
  ```json
  {
    "username": "string",
    "password": "string"
  }
  ```
- **Response**: User details and/or token.
  ```json
  { "username": "string", "token": "string_jwt_token_example" } 
  ```
  (Actual response depends on auth implementation)

#### `GET /users/{username}`
- **Description**: Retrieve public details for a user. (Sensitive info like password hash should not be returned).
- **Path Parameters**:
  - `username` (string): Username to query.
- **Response**:
  ```json
  {
    "username": "string"
    // Add other public fields if any
  }
  ```

#### `DELETE /users/{username}`
- **Description**: Delete a user by their username. (Requires admin rights or self-deletion with auth).
- **Path Parameters**:
  - `username` (string): Username to delete.
- **Response**:
  ```json
  {
    "status": "ok",
    "message": "User deleted successfully"
  }
  ```

### Emotions Management

#### `GET /emotions/`
- **Description**: Retrieve all defined emotions and their associated colors. Used by the frontend to populate emotion selectors and color map markers.
- **Response**:
  ```json
  [
    {
      "emotion": "string", // e.g., "joy"
      "color": "string"  // e.g., "#FFD700"
    }
  ]
  ```

#### `POST /emotions/`
- **Description**: Add a new emotion and its color. (Primarily for administrative or initial setup purposes).
- **Request Body**:
  ```json
  {
    "emotion": "string",
    "color": "string"
  }
  ```
- **Response**: The created emotion object.

## Running the Service

1.  Navigate to the `mongodb-service` directory:
    ```bash
    cd backend/mongodb-service
    ```
2.  Install dependencies:
    ```bash
    pip install -r requirements.txt
    ```
3.  Start the service (default port 8001):
    ```bash
    uvicorn main:app --host 0.0.0.0 --port 8001 --reload
    ```
    Access API docs at `http://localhost:8001/docs`.

## Configuration
The service connects to a MongoDB instance. Configuration details (host, port, database name, collection names) are typically managed in `config/config.py` and can be set using environment variables:
- `MONGO_HOST`
- `MONGO_PORT`
- `MONGO_DB_NAME`
- `MONGO_USER` (optional)
- `MONGO_PASSWORD` (optional)